<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MindMap Theme & Container Test</title>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--mm-bg, #f8fafc);
            transition: background-color 0.3s ease;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        h1 {
            color: var(--mm-text, #1e293b);
            margin-bottom: 10px;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            background: var(--mm-primary, #4dabf7);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        button:hover {
            background: var(--mm-primary-hover, #339af7);
            transform: translateY(-2px);
        }
        
        .container-wrapper {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .container-label {
            color: var(--mm-text, #1e293b);
            font-weight: 600;
            margin-bottom: 10px;
            padding: 8px 16px;
            background: var(--mm-bg-secondary, #f8f9fa);
            border-radius: 6px;
            display: inline-block;
        }
        
        #container1, #container2 {
            margin-bottom: 30px;
        }
        
        .info-panel {
            background: var(--mm-bg-secondary, #f8f9fa);
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            color: var(--mm-text, #1e293b);
        }
        
        .info-panel h3 {
            margin-top: 0;
        }
        
        code {
            background: var(--mm-bg-tertiary, #e9ecef);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Monaco', 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <div class="container-wrapper">
        <div class="header">
            <h1>üß† MindViz Configuration Test</h1>
            <p>Testing new centralized theme and container configuration</p>
        </div>
        
        <div class="controls">
            <button onclick="toggleTheme()">üåì Toggle Theme</button>
            <button onclick="showTheme()">üìã Show Theme</button>
            <button onclick="resizeContainers()">üìè Resize Containers</button>
            <button onclick="addNodes()">‚ûï Add Nodes</button>
        </div>
        
        <div class="container-label">Default Configuration (600px height, both resize)</div>
        <div id="container1"></div>
        
        <div class="container-label">Custom Configuration (400px height, vertical resize only)</div>
        <div id="container2"></div>
        
        <div class="info-panel">
            <h3>Configuration Info</h3>
            <div id="info">Loading...</div>
        </div>
    </div>

    <script type="module">
        import { MindMap, VisualMindMap, themeManager, DEFAULT_MINDMAP_CONTAINER } from '/dist/index.js';

        // Test 1: MindMap with default container config
        const mindMap1 = new MindMap();
        mindMap1.addNode("Central Idea", "This demonstrates the new configuration system");
        const root1 = mindMap1.getNode(0);
        mindMap1.addNode("Theme System", "Centralized theme management with ThemeManager singleton", root1);
        mindMap1.addNode("Container Config", "Easy to configure container sizing", root1);
        mindMap1.addNode("Persistence", "Theme persists in localStorage", root1);
        
        const container1 = document.getElementById('container1');
        const vmm1 = new VisualMindMap(container1, mindMap1);
        vmm1.render();

        // Test 2: MindMap with custom container config
        const mindMap2 = new MindMap();
        mindMap2.addNode("Custom Size", "This uses custom container configuration");
        const root2 = mindMap2.getNode(0);
        mindMap2.addNode("400px Height", "More compact view", root2);
        mindMap2.addNode("Vertical Resize", "Can only resize vertically", root2);
        
        const container2 = document.getElementById('container2');
        const customConfig = {
            width: '100%',
            height: '400px',
            minHeight: '300px',
            borderRadius: '16px',
            resize: 'vertical'
        };
        const vmm2 = new VisualMindMap(container2, mindMap2, customConfig);
        vmm2.render();

        // Subscribe to theme changes to update body background
        themeManager.subscribe((theme) => {
            document.body.style.background = theme === 'dark' 
                ? '#12171f' 
                : '#f8fafc';
            updateInfo();
        });

        // Global functions for testing
        window.toggleTheme = () => {
            themeManager.toggleTheme();
        };

        window.showTheme = () => {
            const theme = themeManager.getTheme();
            alert(`Current theme: ${theme}\n\nTheme is persisted in localStorage and will be remembered on page reload.`);
        };

        window.resizeContainers = () => {
            container1.style.height = '500px';
            container2.style.height = '350px';
            updateInfo();
        };

        window.addNodes = () => {
            const root1 = mindMap1.getNode(0);
            const newNode = mindMap1.addNode(`Node ${mindMap1.nodes.length}`, "Dynamically added", root1);
            vmm1.render();
            
            const root2 = mindMap2.getNode(0);
            mindMap2.addNode(`Node ${mindMap2.nodes.length}`, "Also dynamic", root2);
            vmm2.render();
            
            updateInfo();
        };

        function updateInfo() {
            const theme = themeManager.getTheme();
            const container1Height = container1.style.height || DEFAULT_MINDMAP_CONTAINER.height;
            const container2Height = container2.style.height || customConfig.height;
            
            document.getElementById('info').innerHTML = `
                <strong>Current Theme:</strong> <code>${theme}</code><br>
                <strong>Container 1 Height:</strong> <code>${container1Height}</code> (resize: <code>both</code>)<br>
                <strong>Container 2 Height:</strong> <code>${container2Height}</code> (resize: <code>vertical</code>)<br>
                <strong>MindMap 1 Nodes:</strong> <code>${mindMap1.nodes.length}</code><br>
                <strong>MindMap 2 Nodes:</strong> <code>${mindMap2.nodes.length}</code><br>
                <br>
                <strong>Features:</strong><br>
                ‚Ä¢ Theme persists across page reloads (localStorage)<br>
                ‚Ä¢ Follows system color scheme preference by default<br>
                ‚Ä¢ All CSS variables automatically update on theme change<br>
                ‚Ä¢ Container sizing is now centralized and configurable<br>
                ‚Ä¢ Try resizing containers by dragging the bottom-right corner!
            `;
        }

        // Initialize info display
        updateInfo();
        
        // Log for debugging
        console.log('MindViz initialized with:');
        console.log('- Default config:', DEFAULT_MINDMAP_CONTAINER);
        console.log('- Custom config:', customConfig);
        console.log('- Initial theme:', themeManager.getTheme());
    </script>
</body>
</html>
